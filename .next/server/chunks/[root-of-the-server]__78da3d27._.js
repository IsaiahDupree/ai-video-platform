module.exports=[193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},939920,271448,e=>{"use strict";var t,r,a,s,o,n,i,l=e.i(522734),u=e.i(814747),c=((t={}).OWNER="owner",t.ADMIN="admin",t.EDITOR="editor",t.VIEWER="viewer",t);(r={}).WORKSPACE="workspace",r.BRAND_KIT="brand_kit",r.AD_TEMPLATE="ad_template",r.CAMPAIGN="campaign",r.RENDER="render",r.MEMBER="member",r.SETTINGS="settings",(a={}).CREATE="create",a.READ="read",a.UPDATE="update",a.DELETE="delete",a.MANAGE="manage",a.RENDER="render",a.EXPORT="export",a.INVITE="invite";var d=((s={}).DRAFT="draft",s.IN_REVIEW="in_review",s.APPROVED="approved",s.REJECTED="rejected",s.CHANGES_REQUESTED="changes_requested",s);(o={}).AD="ad",o.CAMPAIGN="campaign",o.AD_VARIANT="ad_variant",o.CAMPAIGN_ASSET="campaign_asset";let p={enabled:!1,requiredApprovers:1,allowedApproverRoles:[c.OWNER,c.ADMIN],allowedReviewerRoles:[c.OWNER,c.ADMIN,c.EDITOR],autoApproveOwner:!0,requireCommentOnReject:!0,notifyOnStatusChange:!0,notifyApprovers:!0};var R=((n={}).SUBMIT_FOR_REVIEW="submit_for_review",n.APPROVE="approve",n.REJECT="reject",n.REQUEST_CHANGES="request_changes",n.REVERT_TO_DRAFT="revert_to_draft",n);function E(e,t){return({draft:["in_review"],in_review:["approved","rejected","changes_requested","draft"],approved:["draft"],rejected:["draft"],changes_requested:["draft","in_review"]})[e]?.includes(t)||!1}function v(e,t,r,a){switch(e){case"submit_for_review":return r.allowedReviewerRoles.includes(t);case"approve":case"reject":case"request_changes":return r.allowedApproverRoles.includes(t);case"revert_to_draft":return a||t===c.OWNER||t===c.ADMIN;default:return!1}}e.s(["ApprovalAction",()=>R,"ApprovalStatus",()=>d,"DEFAULT_APPROVAL_SETTINGS",0,p,"canPerformAction",()=>v,"isValidStatusTransition",()=>E],271448);var h=((i={}).SCREENSHOT="screenshot",i.SCREENSHOT_SET="screenshot_set",i.CUSTOM_PRODUCT_PAGE="custom_product_page",i.APP_PREVIEW_VIDEO="app_preview_video",i.LOCALIZED_METADATA="localized_metadata",i.PPO_TREATMENT="ppo_treatment",i);class f{dataDir;resourcesDir;commentsDir;historyDir;constructor(e="data/apple-approvals"){this.dataDir=e,this.resourcesDir=u.default.join(e,"resources"),this.commentsDir=u.default.join(e,"comments"),this.historyDir=u.default.join(e,"history"),this.ensureDirectories()}ensureDirectories(){[this.dataDir,this.resourcesDir,this.commentsDir,this.historyDir].forEach(e=>{l.default.existsSync(e)||l.default.mkdirSync(e,{recursive:!0})})}async getApprovalSettings(e){return{...p,enabled:!0}}async getResource(e){let t=u.default.join(this.resourcesDir,`${e}.json`);return l.default.existsSync(t)?JSON.parse(l.default.readFileSync(t,"utf-8")):null}async saveResource(e){let t=u.default.join(this.resourcesDir,`${e.id}.json`);e.updatedAt=new Date().toISOString(),l.default.writeFileSync(t,JSON.stringify(e,null,2))}async createResource(e){let t={...e,id:`${e.resourceType}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,approvalStatus:d.DRAFT,approvalHistory:[],comments:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await this.saveResource(t),t}async listResources(e={}){let t=l.default.readdirSync(this.resourcesDir).filter(e=>e.endsWith(".json")),r=[];for(let e of t){let t=JSON.parse(l.default.readFileSync(u.default.join(this.resourcesDir,e),"utf-8"));r.push(t)}if(e.workspaceId&&(r=r.filter(t=>t.workspaceId===e.workspaceId)),e.resourceType){let t=Array.isArray(e.resourceType)?e.resourceType:[e.resourceType];r=r.filter(e=>t.includes(e.resourceType))}if(e.status){let t=Array.isArray(e.status)?e.status:[e.status];r=r.filter(e=>t.includes(e.approvalStatus))}if(e.appId&&(r=r.filter(t=>"appId"in t&&t.appId===e.appId)),e.locale&&(r=r.filter(t=>"locale"in t&&t.locale===e.locale)),e.deviceType&&(r=r.filter(t=>"deviceType"in t&&t.deviceType===e.deviceType)),e.createdBy&&(r=r.filter(t=>t.createdBy===e.createdBy)),e.searchQuery){let t=e.searchQuery.toLowerCase();r=r.filter(e=>e.name.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.tags?.some(e=>e.toLowerCase().includes(t)))}return r.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),r}async performAction(e,t,r,a,s,o,n,i){let l,u=await this.getResource(e);if(!u)return{success:!1,error:"Resource not found"};let c=await this.getApprovalSettings(u.workspaceId);if(!v(t,o,c,u.createdBy===r))return{success:!1,error:"You do not have permission to perform this action"};switch(t){case R.SUBMIT_FOR_REVIEW:l=d.IN_REVIEW;break;case R.APPROVE:l=d.APPROVED;break;case R.REJECT:l=d.REJECTED;break;case R.REQUEST_CHANGES:l=d.CHANGES_REQUESTED;break;case R.REVERT_TO_DRAFT:l=d.DRAFT;break;default:return{success:!1,error:"Invalid action"}}if(!E(u.approvalStatus,l))return{success:!1,error:`Cannot transition from ${u.approvalStatus} to ${l}`};if(c.requireCommentOnReject&&(t===R.REJECT||t===R.REQUEST_CHANGES)&&!n&&!i)return{success:!1,error:"Comment or reason is required for rejection or change requests"};let p={id:`change-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,resourceId:u.id,resourceType:u.resourceType,fromStatus:u.approvalStatus,toStatus:l,changedBy:r,changedByName:a,changedByEmail:s,changedByRole:o,reason:i||n,timestamp:new Date().toISOString()};if(u.approvalStatus=l,u.approvalHistory.push(p),t===R.SUBMIT_FOR_REVIEW?(u.submittedForReviewAt=p.timestamp,u.submittedForReviewBy=r):t===R.APPROVE?(u.approvedAt=p.timestamp,u.approvedBy=r):t===R.REJECT&&(u.rejectedAt=p.timestamp,u.rejectedBy=r),n){let e={id:`comment-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,resourceId:u.id,resourceType:u.resourceType,authorId:r,authorName:a,authorEmail:s,authorRole:o,content:n,createdAt:new Date().toISOString(),isInternal:!1};u.comments.push(e),await this.saveComment(e)}return await this.saveResource(u),await this.saveStatusChange(p),{success:!0,message:`Successfully ${t.replace(/_/g," ")}`}}async addComment(e,t,r,a,s,o,n=!1,i){let l=await this.getResource(e);if(!l)return null;let u={id:`comment-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,resourceId:l.id,resourceType:l.resourceType,authorId:t,authorName:r,authorEmail:a,authorRole:s,content:o,createdAt:new Date().toISOString(),isInternal:n,attachments:i};return l.comments.push(u),await this.saveResource(l),await this.saveComment(u),u}async getComments(e){let t=await this.getResource(e);return t?.comments||[]}async getHistory(e){let t=await this.getResource(e);return t?.approvalHistory||[]}async getStatistics(e={}){let t=await this.listResources(e),r={totalDraft:0,totalInReview:0,totalApproved:0,totalRejected:0,totalChangesRequested:0,byResourceType:{},byApp:{},avgTimeToApproval:0,approvalRate:0};Object.values(h).forEach(e=>{r.byResourceType[e]={draft:0,inReview:0,approved:0,rejected:0}});let a=0,s=0;for(let e of t){switch(e.approvalStatus){case d.DRAFT:r.totalDraft++,r.byResourceType[e.resourceType].draft++;break;case d.IN_REVIEW:r.totalInReview++,r.byResourceType[e.resourceType].inReview++;break;case d.APPROVED:r.totalApproved++,r.byResourceType[e.resourceType].approved++;break;case d.REJECTED:r.totalRejected++,r.byResourceType[e.resourceType].rejected++;break;case d.CHANGES_REQUESTED:r.totalChangesRequested++}if("appId"in e){let t=e.appId;r.byApp[t]||(r.byApp[t]={appName:t,total:0,approved:0}),r.byApp[t].total++,e.approvalStatus===d.APPROVED&&r.byApp[t].approved++}if(e.approvedAt&&e.submittedForReviewAt){let t=new Date(e.submittedForReviewAt).getTime();a+=new Date(e.approvedAt).getTime()-t,s++}}r.avgTimeToApproval=s>0?a/s:0;let o=r.totalApproved+r.totalRejected;return r.approvalRate=o>0?r.totalApproved/o*100:0,r}async saveComment(e){let t=u.default.join(this.commentsDir,`${e.id}.json`);l.default.writeFileSync(t,JSON.stringify(e,null,2))}async saveStatusChange(e){let t=u.default.join(this.historyDir,`${e.id}.json`);l.default.writeFileSync(t,JSON.stringify(e,null,2))}async deleteResource(e){let t=u.default.join(this.resourcesDir,`${e}.json`);return!!l.default.existsSync(t)&&(l.default.unlinkSync(t),!0)}}let m=null;function A(){return m||(m=new f),m}e.s(["getAppleApprovalService",()=>A],939920)},521006,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),s=e.i(759756),o=e.i(561916),n=e.i(174677),i=e.i(869741),l=e.i(316795),u=e.i(487718),c=e.i(995169),d=e.i(47587),p=e.i(666012),R=e.i(570101),E=e.i(626937),v=e.i(10372),h=e.i(193695);e.i(52474);var f=e.i(600220),m=e.i(89171),A=e.i(939920);async function y(e,{params:t}){try{let e=(0,A.getAppleApprovalService)(),r=await e.getResource(t.id);if(!r)return m.NextResponse.json({success:!1,error:"Resource not found"},{status:404});return m.NextResponse.json({success:!0,resource:r})}catch(e){return console.error("Failed to get Apple approval resource:",e),m.NextResponse.json({success:!1,error:"Failed to load resource",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}e.s(["GET",()=>y],72011);var T=e.i(72011);let w=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/review/apple/[id]/route",pathname:"/api/review/apple/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/review/apple/[id]/route.ts",nextConfigOutput:"standalone",userland:T}),{workAsyncStorage:g,workUnitAsyncStorage:S,serverHooks:D}=w;function _(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:S})}async function C(e,t,a){w.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/review/apple/[id]/route";m=m.replace(/\/index$/,"")||"/";let A=await w.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!A)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:T,nextConfig:g,parsedUrl:S,isDraftMode:D,prerenderManifest:_,routerServerContext:C,isOnDemandRevalidate:x,revalidateOnlyGenerated:I,resolvedPathname:N,clientReferenceManifest:O,serverActionsManifest:b}=A,P=(0,i.normalizeAppPath)(m),j=!!(_.dynamicRoutes[P]||_.routes[N]),k=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,S,!1):t.end("This page could not be found"),null);if(j&&!D){let e=!!_.routes[N],t=_.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(g.experimental.adapterPath)return await k();throw new h.NoFallbackError}}let q=null;!j||w.isDev||D||(q="/index"===(q=N)?"/":q);let M=!0===w.isDev||!j,U=j&&!M;b&&O&&(0,n.setManifestsSingleton)({page:m,clientReferenceManifest:O,serverActionsManifest:b});let F=e.method||"GET",H=(0,o.getTracer)(),$=H.getActiveScopeSpan(),V={params:T,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!g.experimental.authInterrupts},cacheComponents:!!g.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:g.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,s)=>w.onRequestError(e,t,a,s,C)},sharedContext:{buildId:y}},B=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),W=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let n=async e=>w.handle(W,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${m}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var o,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&x&&I&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(s);e.fetchMetrics=V.renderOpts.fetchMetrics;let l=V.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=V.renderOpts.collectedTags;if(!j)return await (0,p.sendResponse)(B,G,o,V.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,a=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,C),t}},c=await w.handleResponse({req:e,nextConfig:g,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:I,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:i});if(!j)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",x?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),D&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,R.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&j||h.delete(v.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,E.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(B,G,new Response(c.value.body,{headers:h,status:c.value.status||200})),null};$?await l($):await H.withPropagatedContext(e.headers,()=>H.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${m}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:x})},!1,C),j)throw t;return await (0,p.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>_,"routeModule",()=>w,"serverHooks",()=>D,"workAsyncStorage",()=>g,"workUnitAsyncStorage",()=>S],521006)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__78da3d27._.js.map