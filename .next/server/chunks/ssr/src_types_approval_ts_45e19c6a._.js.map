{"version":3,"sources":["../../../../src/types/workspace.ts","../../../../src/types/approval.ts"],"sourcesContent":["/**\n * Workspace Types - ADS-014\n * Type definitions for workspace management and role-based access control\n */\n\n/**\n * User role in a workspace\n */\nexport enum WorkspaceRole {\n  OWNER = 'owner',\n  ADMIN = 'admin',\n  EDITOR = 'editor',\n  VIEWER = 'viewer',\n}\n\n/**\n * Workspace member\n */\nexport interface WorkspaceMember {\n  userId: string;\n  email: string;\n  name?: string;\n  role: WorkspaceRole;\n  invitedAt: string;\n  acceptedAt?: string;\n  invitedBy: string; // userId\n  lastActiveAt?: string;\n}\n\n/**\n * Workspace configuration\n */\nexport interface Workspace {\n  id: string;\n  name: string;\n  description?: string;\n  ownerId: string; // User ID of the workspace owner\n\n  // Members and access\n  members: WorkspaceMember[];\n\n  // Settings\n  settings: WorkspaceSettings;\n\n  // Metadata\n  createdAt: string;\n  updatedAt: string;\n  isActive: boolean;\n}\n\n/**\n * Workspace settings\n */\nexport interface WorkspaceSettings {\n  // Brand settings\n  defaultBrandKitId?: string;\n\n  // Render settings\n  renderQuality?: 'draft' | 'standard' | 'high';\n  maxConcurrentRenders?: number;\n\n  // Storage settings\n  storageProvider?: 's3' | 'r2' | 'local';\n  storageBucket?: string;\n\n  // Collaboration settings\n  allowGuestAccess?: boolean;\n  requireApproval?: boolean;\n\n  // Notification settings\n  webhookUrl?: string;\n  emailNotifications?: boolean;\n}\n\n/**\n * Permission definition\n */\nexport interface Permission {\n  resource: ResourceType;\n  action: ActionType;\n  roles: WorkspaceRole[];\n}\n\n/**\n * Resource types in the system\n */\nexport enum ResourceType {\n  WORKSPACE = 'workspace',\n  BRAND_KIT = 'brand_kit',\n  AD_TEMPLATE = 'ad_template',\n  CAMPAIGN = 'campaign',\n  RENDER = 'render',\n  MEMBER = 'member',\n  SETTINGS = 'settings',\n}\n\n/**\n * Action types\n */\nexport enum ActionType {\n  CREATE = 'create',\n  READ = 'read',\n  UPDATE = 'update',\n  DELETE = 'delete',\n  MANAGE = 'manage',\n  RENDER = 'render',\n  EXPORT = 'export',\n  INVITE = 'invite',\n}\n\n/**\n * Permission check result\n */\nexport interface PermissionCheckResult {\n  allowed: boolean;\n  reason?: string;\n  requiredRole?: WorkspaceRole;\n}\n\n/**\n * Workspace invitation\n */\nexport interface WorkspaceInvitation {\n  id: string;\n  workspaceId: string;\n  email: string;\n  role: WorkspaceRole;\n  invitedBy: string;\n  invitedAt: string;\n  expiresAt: string;\n  token: string;\n  status: 'pending' | 'accepted' | 'expired' | 'revoked';\n}\n\n/**\n * User context for authorization\n */\nexport interface UserContext {\n  userId: string;\n  email: string;\n  name?: string;\n  workspaces: {\n    workspaceId: string;\n    role: WorkspaceRole;\n  }[];\n}\n\n/**\n * Default role permissions\n * Defines what each role can do\n */\nexport const ROLE_PERMISSIONS: Record<WorkspaceRole, Permission[]> = {\n  [WorkspaceRole.OWNER]: [\n    // Owners can do everything\n    { resource: ResourceType.WORKSPACE, action: ActionType.MANAGE, roles: [WorkspaceRole.OWNER] },\n    { resource: ResourceType.BRAND_KIT, action: ActionType.MANAGE, roles: [WorkspaceRole.OWNER] },\n    { resource: ResourceType.AD_TEMPLATE, action: ActionType.MANAGE, roles: [WorkspaceRole.OWNER] },\n    { resource: ResourceType.CAMPAIGN, action: ActionType.MANAGE, roles: [WorkspaceRole.OWNER] },\n    { resource: ResourceType.RENDER, action: ActionType.MANAGE, roles: [WorkspaceRole.OWNER] },\n    { resource: ResourceType.MEMBER, action: ActionType.MANAGE, roles: [WorkspaceRole.OWNER] },\n    { resource: ResourceType.SETTINGS, action: ActionType.MANAGE, roles: [WorkspaceRole.OWNER] },\n  ],\n  [WorkspaceRole.ADMIN]: [\n    // Admins can manage most things except workspace deletion\n    { resource: ResourceType.WORKSPACE, action: ActionType.READ, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.WORKSPACE, action: ActionType.UPDATE, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.BRAND_KIT, action: ActionType.MANAGE, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.AD_TEMPLATE, action: ActionType.MANAGE, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.CAMPAIGN, action: ActionType.MANAGE, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.RENDER, action: ActionType.MANAGE, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.MEMBER, action: ActionType.INVITE, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.MEMBER, action: ActionType.READ, roles: [WorkspaceRole.ADMIN] },\n    { resource: ResourceType.SETTINGS, action: ActionType.UPDATE, roles: [WorkspaceRole.ADMIN] },\n  ],\n  [WorkspaceRole.EDITOR]: [\n    // Editors can create and edit content\n    { resource: ResourceType.WORKSPACE, action: ActionType.READ, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.BRAND_KIT, action: ActionType.READ, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.AD_TEMPLATE, action: ActionType.CREATE, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.AD_TEMPLATE, action: ActionType.READ, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.AD_TEMPLATE, action: ActionType.UPDATE, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.CAMPAIGN, action: ActionType.CREATE, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.CAMPAIGN, action: ActionType.READ, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.CAMPAIGN, action: ActionType.UPDATE, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.RENDER, action: ActionType.RENDER, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.RENDER, action: ActionType.READ, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.RENDER, action: ActionType.EXPORT, roles: [WorkspaceRole.EDITOR] },\n    { resource: ResourceType.MEMBER, action: ActionType.READ, roles: [WorkspaceRole.EDITOR] },\n  ],\n  [WorkspaceRole.VIEWER]: [\n    // Viewers can only read\n    { resource: ResourceType.WORKSPACE, action: ActionType.READ, roles: [WorkspaceRole.VIEWER] },\n    { resource: ResourceType.BRAND_KIT, action: ActionType.READ, roles: [WorkspaceRole.VIEWER] },\n    { resource: ResourceType.AD_TEMPLATE, action: ActionType.READ, roles: [WorkspaceRole.VIEWER] },\n    { resource: ResourceType.CAMPAIGN, action: ActionType.READ, roles: [WorkspaceRole.VIEWER] },\n    { resource: ResourceType.RENDER, action: ActionType.READ, roles: [WorkspaceRole.VIEWER] },\n    { resource: ResourceType.MEMBER, action: ActionType.READ, roles: [WorkspaceRole.VIEWER] },\n  ],\n};\n\n/**\n * Type guard for WorkspaceRole\n */\nexport function isValidWorkspaceRole(role: string): role is WorkspaceRole {\n  return Object.values(WorkspaceRole).includes(role as WorkspaceRole);\n}\n\n/**\n * Type guard for Workspace\n */\nexport function isWorkspace(obj: any): obj is Workspace {\n  return (\n    obj &&\n    typeof obj === 'object' &&\n    typeof obj.id === 'string' &&\n    typeof obj.name === 'string' &&\n    typeof obj.ownerId === 'string' &&\n    Array.isArray(obj.members) &&\n    obj.settings &&\n    typeof obj.createdAt === 'string' &&\n    typeof obj.updatedAt === 'string' &&\n    typeof obj.isActive === 'boolean'\n  );\n}\n\n/**\n * Type guard for WorkspaceMember\n */\nexport function isWorkspaceMember(obj: any): obj is WorkspaceMember {\n  return (\n    obj &&\n    typeof obj === 'object' &&\n    typeof obj.userId === 'string' &&\n    typeof obj.email === 'string' &&\n    isValidWorkspaceRole(obj.role) &&\n    typeof obj.invitedAt === 'string' &&\n    typeof obj.invitedBy === 'string'\n  );\n}\n\n/**\n * Default workspace settings\n */\nexport const DEFAULT_WORKSPACE_SETTINGS: WorkspaceSettings = {\n  renderQuality: 'standard',\n  maxConcurrentRenders: 5,\n  storageProvider: 'local',\n  allowGuestAccess: false,\n  requireApproval: false,\n  emailNotifications: true,\n};\n\n/**\n * Helper to create a workspace with default values\n */\nexport function createWorkspace(\n  partial: Partial<Workspace> & {\n    id: string;\n    name: string;\n    ownerId: string;\n  }\n): Workspace {\n  const now = new Date().toISOString();\n\n  // Owner is automatically added as a member\n  const ownerMember: WorkspaceMember = {\n    userId: partial.ownerId,\n    email: partial.members?.[0]?.email || 'owner@example.com',\n    name: partial.members?.[0]?.name,\n    role: WorkspaceRole.OWNER,\n    invitedAt: now,\n    acceptedAt: now,\n    invitedBy: partial.ownerId,\n    lastActiveAt: now,\n  };\n\n  return {\n    description: '',\n    members: [ownerMember],\n    settings: DEFAULT_WORKSPACE_SETTINGS,\n    isActive: true,\n    createdAt: now,\n    updatedAt: now,\n    ...partial,\n  };\n}\n\n/**\n * Helper to check if a user has a specific role or higher\n */\nexport function hasRoleOrHigher(userRole: WorkspaceRole, requiredRole: WorkspaceRole): boolean {\n  const roleHierarchy = [\n    WorkspaceRole.VIEWER,\n    WorkspaceRole.EDITOR,\n    WorkspaceRole.ADMIN,\n    WorkspaceRole.OWNER,\n  ];\n\n  const userLevel = roleHierarchy.indexOf(userRole);\n  const requiredLevel = roleHierarchy.indexOf(requiredRole);\n\n  return userLevel >= requiredLevel;\n}\n","/**\n * Approval Workflow Types - ADS-016\n * Type definitions for approval workflow: Draft → In Review → Approved\n */\n\nimport { WorkspaceRole } from './workspace';\n\n/**\n * Approval status enum\n * Defines the lifecycle of an asset in the approval workflow\n */\nexport enum ApprovalStatus {\n  DRAFT = 'draft',\n  IN_REVIEW = 'in_review',\n  APPROVED = 'approved',\n  REJECTED = 'rejected',\n  CHANGES_REQUESTED = 'changes_requested',\n}\n\n/**\n * Resource types that can be approved\n */\nexport enum ApprovableResourceType {\n  AD = 'ad',\n  CAMPAIGN = 'campaign',\n  AD_VARIANT = 'ad_variant',\n  CAMPAIGN_ASSET = 'campaign_asset',\n}\n\n/**\n * Comment on an approvable resource\n */\nexport interface ApprovalComment {\n  id: string;\n  resourceId: string;\n  resourceType: ApprovableResourceType;\n  authorId: string;\n  authorName: string;\n  authorEmail: string;\n  authorRole: WorkspaceRole;\n  content: string;\n  createdAt: string;\n  updatedAt?: string;\n  isInternal?: boolean; // Internal notes vs client-facing comments\n  attachments?: string[]; // URLs or paths to attached files\n}\n\n/**\n * Status change event in approval history\n */\nexport interface ApprovalStatusChange {\n  id: string;\n  resourceId: string;\n  resourceType: ApprovableResourceType;\n  fromStatus?: ApprovalStatus;\n  toStatus: ApprovalStatus;\n  changedBy: string;\n  changedByName: string;\n  changedByEmail: string;\n  changedByRole: WorkspaceRole;\n  reason?: string;\n  timestamp: string;\n}\n\n/**\n * Approvable resource base interface\n * Any resource that can go through approval workflow should implement this\n */\nexport interface ApprovableResource {\n  id: string;\n  workspaceId: string;\n  resourceType: ApprovableResourceType;\n  name: string;\n  description?: string;\n\n  // Approval workflow fields\n  approvalStatus: ApprovalStatus;\n  approvalHistory: ApprovalStatusChange[];\n  comments: ApprovalComment[];\n\n  // Ownership and tracking\n  createdBy: string;\n  createdByName: string;\n  createdByEmail: string;\n  createdAt: string;\n  updatedAt: string;\n\n  // Review tracking\n  submittedForReviewAt?: string;\n  submittedForReviewBy?: string;\n  approvedAt?: string;\n  approvedBy?: string;\n  rejectedAt?: string;\n  rejectedBy?: string;\n\n  // Metadata\n  thumbnailUrl?: string;\n  previewUrl?: string;\n  tags?: string[];\n}\n\n/**\n * Approval workflow settings\n * Controls how approval works in a workspace\n */\nexport interface ApprovalWorkflowSettings {\n  enabled: boolean;\n  requiredApprovers: number; // Minimum number of approvals needed\n  allowedApproverRoles: WorkspaceRole[]; // Roles that can approve\n  allowedReviewerRoles: WorkspaceRole[]; // Roles that can submit for review\n  autoApproveOwner: boolean; // Owner's submissions auto-approve\n  requireCommentOnReject: boolean;\n  notifyOnStatusChange: boolean;\n  notifyApprovers: boolean;\n}\n\n/**\n * Default approval workflow settings\n */\nexport const DEFAULT_APPROVAL_SETTINGS: ApprovalWorkflowSettings = {\n  enabled: false,\n  requiredApprovers: 1,\n  allowedApproverRoles: [WorkspaceRole.OWNER, WorkspaceRole.ADMIN],\n  allowedReviewerRoles: [WorkspaceRole.OWNER, WorkspaceRole.ADMIN, WorkspaceRole.EDITOR],\n  autoApproveOwner: true,\n  requireCommentOnReject: true,\n  notifyOnStatusChange: true,\n  notifyApprovers: true,\n};\n\n/**\n * Approval action types\n */\nexport enum ApprovalAction {\n  SUBMIT_FOR_REVIEW = 'submit_for_review',\n  APPROVE = 'approve',\n  REJECT = 'reject',\n  REQUEST_CHANGES = 'request_changes',\n  REVERT_TO_DRAFT = 'revert_to_draft',\n}\n\n/**\n * Approval action request\n */\nexport interface ApprovalActionRequest {\n  resourceId: string;\n  resourceType: ApprovableResourceType;\n  action: ApprovalAction;\n  userId: string;\n  userRole: WorkspaceRole;\n  comment?: string;\n  reason?: string;\n}\n\n/**\n * Approval action result\n */\nexport interface ApprovalActionResult {\n  success: boolean;\n  newStatus: ApprovalStatus;\n  statusChange: ApprovalStatusChange;\n  message?: string;\n  error?: string;\n}\n\n/**\n * Approval statistics for a workspace\n */\nexport interface ApprovalStatistics {\n  totalDraft: number;\n  totalInReview: number;\n  totalApproved: number;\n  totalRejected: number;\n  totalChangesRequested: number;\n  avgTimeToApproval: number; // milliseconds\n  approvalRate: number; // percentage\n}\n\n/**\n * Filter options for approval queries\n */\nexport interface ApprovalFilter {\n  workspaceId?: string;\n  resourceType?: ApprovableResourceType;\n  status?: ApprovalStatus[];\n  createdBy?: string;\n  approvedBy?: string;\n  tags?: string[];\n  fromDate?: string;\n  toDate?: string;\n  searchQuery?: string;\n}\n\n/**\n * Approval notification\n */\nexport interface ApprovalNotification {\n  id: string;\n  workspaceId: string;\n  recipientId: string;\n  recipientEmail: string;\n  resourceId: string;\n  resourceType: ApprovableResourceType;\n  resourceName: string;\n  type: 'submitted' | 'approved' | 'rejected' | 'changes_requested' | 'comment_added';\n  title: string;\n  message: string;\n  actionUrl?: string;\n  createdAt: string;\n  readAt?: string;\n}\n\n/**\n * Type guard for ApprovableResource\n */\nexport function isApprovableResource(obj: any): obj is ApprovableResource {\n  return (\n    obj &&\n    typeof obj === 'object' &&\n    typeof obj.id === 'string' &&\n    typeof obj.workspaceId === 'string' &&\n    typeof obj.resourceType === 'string' &&\n    Object.values(ApprovableResourceType).includes(obj.resourceType) &&\n    typeof obj.approvalStatus === 'string' &&\n    Object.values(ApprovalStatus).includes(obj.approvalStatus) &&\n    Array.isArray(obj.approvalHistory) &&\n    Array.isArray(obj.comments)\n  );\n}\n\n/**\n * Helper: Check if a status transition is valid\n */\nexport function isValidStatusTransition(\n  from: ApprovalStatus,\n  to: ApprovalStatus\n): boolean {\n  const validTransitions: Record<ApprovalStatus, ApprovalStatus[]> = {\n    [ApprovalStatus.DRAFT]: [ApprovalStatus.IN_REVIEW],\n    [ApprovalStatus.IN_REVIEW]: [\n      ApprovalStatus.APPROVED,\n      ApprovalStatus.REJECTED,\n      ApprovalStatus.CHANGES_REQUESTED,\n      ApprovalStatus.DRAFT,\n    ],\n    [ApprovalStatus.APPROVED]: [ApprovalStatus.DRAFT], // Can revert to draft for changes\n    [ApprovalStatus.REJECTED]: [ApprovalStatus.DRAFT],\n    [ApprovalStatus.CHANGES_REQUESTED]: [ApprovalStatus.DRAFT, ApprovalStatus.IN_REVIEW],\n  };\n\n  return validTransitions[from]?.includes(to) || false;\n}\n\n/**\n * Helper: Get action from status transition\n */\nexport function getActionForTransition(\n  from: ApprovalStatus,\n  to: ApprovalStatus\n): ApprovalAction | null {\n  if (from === ApprovalStatus.DRAFT && to === ApprovalStatus.IN_REVIEW) {\n    return ApprovalAction.SUBMIT_FOR_REVIEW;\n  }\n  if (from === ApprovalStatus.IN_REVIEW && to === ApprovalStatus.APPROVED) {\n    return ApprovalAction.APPROVE;\n  }\n  if (from === ApprovalStatus.IN_REVIEW && to === ApprovalStatus.REJECTED) {\n    return ApprovalAction.REJECT;\n  }\n  if (from === ApprovalStatus.IN_REVIEW && to === ApprovalStatus.CHANGES_REQUESTED) {\n    return ApprovalAction.REQUEST_CHANGES;\n  }\n  if (to === ApprovalStatus.DRAFT) {\n    return ApprovalAction.REVERT_TO_DRAFT;\n  }\n  return null;\n}\n\n/**\n * Helper: Check if user can perform action\n */\nexport function canPerformAction(\n  action: ApprovalAction,\n  userRole: WorkspaceRole,\n  settings: ApprovalWorkflowSettings,\n  isOwner: boolean\n): boolean {\n  switch (action) {\n    case ApprovalAction.SUBMIT_FOR_REVIEW:\n      return settings.allowedReviewerRoles.includes(userRole);\n\n    case ApprovalAction.APPROVE:\n      return settings.allowedApproverRoles.includes(userRole);\n\n    case ApprovalAction.REJECT:\n    case ApprovalAction.REQUEST_CHANGES:\n      return settings.allowedApproverRoles.includes(userRole);\n\n    case ApprovalAction.REVERT_TO_DRAFT:\n      // Owner and creator can revert, admins can revert if it's in review\n      return isOwner || userRole === WorkspaceRole.OWNER || userRole === WorkspaceRole.ADMIN;\n\n    default:\n      return false;\n  }\n}\n\n/**\n * Helper: Get status badge color\n */\nexport function getStatusColor(status: ApprovalStatus): string {\n  switch (status) {\n    case ApprovalStatus.DRAFT:\n      return '#6b7280'; // gray\n    case ApprovalStatus.IN_REVIEW:\n      return '#f59e0b'; // amber\n    case ApprovalStatus.APPROVED:\n      return '#10b981'; // green\n    case ApprovalStatus.REJECTED:\n      return '#ef4444'; // red\n    case ApprovalStatus.CHANGES_REQUESTED:\n      return '#3b82f6'; // blue\n    default:\n      return '#6b7280';\n  }\n}\n\n/**\n * Helper: Get status display name\n */\nexport function getStatusDisplayName(status: ApprovalStatus): string {\n  switch (status) {\n    case ApprovalStatus.DRAFT:\n      return 'Draft';\n    case ApprovalStatus.IN_REVIEW:\n      return 'In Review';\n    case ApprovalStatus.APPROVED:\n      return 'Approved';\n    case ApprovalStatus.REJECTED:\n      return 'Rejected';\n    case ApprovalStatus.CHANGES_REQUESTED:\n      return 'Changes Requested';\n    default:\n      return status;\n  }\n}\n\n/**\n * Helper: Get action display name\n */\nexport function getActionDisplayName(action: ApprovalAction): string {\n  switch (action) {\n    case ApprovalAction.SUBMIT_FOR_REVIEW:\n      return 'Submit for Review';\n    case ApprovalAction.APPROVE:\n      return 'Approve';\n    case ApprovalAction.REJECT:\n      return 'Reject';\n    case ApprovalAction.REQUEST_CHANGES:\n      return 'Request Changes';\n    case ApprovalAction.REVERT_TO_DRAFT:\n      return 'Revert to Draft';\n    default:\n      return action;\n  }\n}\n"],"names":[],"mappings":"+CAQO,MA8EK,EAaA,ECxFA,IA0HA,ED7HA,IAAA,wEAAA,yVCGL,IAAK,oIAAA,IAWA,gGAoGa,EAAc,KAAK,CAAE,EAAc,KAAK,CACxC,EAAc,KAAK,CAAE,EAAc,KAAK,CAAE,EAAc,MAAM,CAUhF,IAAK,8JAAA,GAiLL,SAAS,EAAe,CAAsB,EACnD,OAAQ,GACN,IAAA,QAUA,QATE,MAAO,SACT,EADoB,GACpB,IAD2B,QAEzB,MAAO,SACT,EADoB,GACpB,KAD4B,MAE1B,MAAO,SACT,EADoB,GACpB,KAD4B,MAE1B,MAAO,SACT,EADoB,GACpB,GAD0B,iBAExB,MAAO,SAGX,CACF,CAJwB,AASjB,OATwB,EASf,EAAqB,CAAsB,EACzD,OAAQ,GACN,IAAA,QACE,MAAO,OACT,KAAA,YACE,MAAO,WACT,KAAA,WACE,MAAO,UACT,KAAA,WACE,MAAO,UACT,KAAA,oBACE,MAAO,mBACT,SACE,OAAO,CACX,CACF"}